<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S∆° ƒë·ªì t∆∞ duy MVP - Firebase AI</title>
    <script src="https://unpkg.com/konva@9.3.6/konva.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-root">
        <section id="auth-section" class="container">
            <div id="login-form" class="form-container">
                <h3>ƒêƒÉng nh·∫≠p S∆° ƒë·ªì t∆∞ duy</h3>
                <p id="login-error" class="error-message hidden"></p>
                <input type="email" id="login-email" placeholder="Email" required>
                <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" required>
                <button id="login-button">ƒêƒÉng nh·∫≠p</button>
                <p class="auth-toggle">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-register-link">ƒêƒÉng k√Ω ngay</a></p>
            </div>
            <div id="register-form" class="form-container hidden">
                <h3>ƒêƒÉng k√Ω t√†i kho·∫£n</h3>
                <p id="register-error" class="error-message hidden"></p>
                <input type="email" id="register-email" placeholder="Email" required>
                <input type="password" id="register-password" placeholder="M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)" required>
                <button id="register-button">ƒêƒÉng k√Ω</button>
                <p class="auth-toggle">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login-link">ƒêƒÉng nh·∫≠p</a></p>
            </div>
        </section>

        <section id="main-app-section" class="container hidden">
            <header>
                <h1 id="main-app-title">B·∫£ng ƒëi·ªÅu khi·ªÉn</h1>
                <div id="user-info">
                    <span id="user-email-display"></span>
                    <button id="logout-button" class="secondary">ƒêƒÉng xu·∫•t</button>
                </div>
            </header>

            <div id="mindmap-management-view">
                <h2>Qu·∫£n l√Ω S∆° ƒë·ªì t∆∞ duy</h2>
                <div style="margin-bottom: 15px;">
                    <input type="text" id="new-mindmap-title-input" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ s∆° ƒë·ªì m·ªõi...">
                    <button id="create-mindmap-button">T·∫°o S∆° ƒë·ªì m·ªõi</button>
                </div>

                <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #fcfcfc;">
                    <h3>‚ú® T·∫°o S∆° ƒë·ªì t∆∞ duy b·∫±ng AI t·ª´ VƒÉn b·∫£n</h3>
                    <textarea id="ai-text-input" placeholder="D√°n vƒÉn b·∫£n c·ªßa b·∫°n v√†o ƒë√¢y (v√≠ d·ª•: m·ªôt b√†i vi·∫øt, m·ªôt kh√°i ni·ªám, m·ªôt danh s√°ch...). AI s·∫Ω gi√∫p b·∫°n bi·∫øn n√≥ th√†nh s∆° ƒë·ªì t∆∞ duy!"
                              style="width: calc(100% - 22px); min-height: 120px; padding: 10px; margin-bottom: 15px; border: 1px solid #dddfe2; border-radius: 6px; font-size: 14px; box-sizing: border-box;"></textarea>
                    <button id="generate-mindmap-from-text-button">T·∫°o S∆° ƒë·ªì v·ªõi AI</button>
                    <input type="text" id="ai-mindmap-title-input" placeholder="Ti√™u ƒë·ªÅ s∆° ƒë·ªì AI (t√πy ch·ªçn)"
                           style="width: calc(100% - 22px); padding: 10px; margin-top: 10px; border: 1px solid #dddfe2; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                </div>
                <div id="mindmap-list-container">
                    <h3>Danh s√°ch s∆° ƒë·ªì c·ªßa b·∫°n:</h3>
                    <div id="mindmap-list-loading" class="loading-indicator hidden">ƒêang t·∫£i danh s√°ch...</div>
                    <ul id="mindmap-list"></ul>
                </div>
            </div>

            <div id="canvas-view" class="hidden">
                <div id="canvas-toolbar">
                    <div class="toolbar-section">
                        <button id="back-to-maps-list-button" class="secondary" title="Quay l·∫°i danh s√°ch">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-short" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
                            </svg>
                        </button>
                        <h2 id="current-mindmap-title-display"></h2>
                    </div>
                    <div class="toolbar-section">
                        <button id="add-child-node-button" title="Th√™m n√∫t con (Click)">Th√™m N√∫t</button>
                        <button id="delete-node-button" class="danger" title="X√≥a n√∫t ƒë√£ ch·ªçn (Delete/Backspace)">X√≥a N√∫t</button>
                    </div>
                    <div class="toolbar-section">
                        <span style="font-size:0.9em; margin-right: 3px;">Zoom:</span>
                        <button id="zoom-in-button" class="secondary" title="Ph√≥ng to">+</button>
                        <button id="zoom-out-button" class="secondary" title="Thu nh·ªè">-</button>
                        <button id="reset-zoom-button" class="secondary" title="Reset zoom">Reset</button>
                    </div>
                    <div class="toolbar-section">
                        <label for="toggle-grid" style="font-size:0.9em; margin-right: 5px;">L∆∞·ªõi:</label>
                        <input type="checkbox" id="toggle-grid" title="Hi·ªÉn th·ªã/·∫®n l∆∞·ªõi">
                    </div>
                    <div class="toolbar-section">
                        <label for="toggle-snap-to-grid" style="font-size:0.9em; margin-right: 5px;">H√∫t l∆∞·ªõi:</label>
                        <input type="checkbox" id="toggle-snap-to-grid" title="B·∫≠t/T·∫Øt h√∫t v√†o l∆∞·ªõi">
                    </div>
                    <div class="toolbar-section">
                        <label for="grid-size-input" style="font-size:0.9em; margin-right: 3px;">K√≠ch th∆∞·ªõc l∆∞·ªõi:</label>
                        <input type="number" id="grid-size-input" value="50" min="10" max="200" step="10" title="K√≠ch th∆∞·ªõc √¥ l∆∞·ªõi">
                    </div>
                    <div id="node-style-panel" class="toolbar-section hidden">
                        <div class="style-group">
                            <label for="node-shape-select">H√¨nh d·∫°ng:</label>
                            <select id="node-shape-select" title="H√¨nh d·∫°ng n√∫t">
                                <option value="rectangle">Ch·ªØ nh·∫≠t</option>
                                <option value="ellipse">Elip</option>
                                <option value="roundedRectangle">Bo g√≥c</option>
                            </select>
                        </div>
                         <div class="style-group">
                            <label for="node-font-family-select">Font:</label>
                            <select id="node-font-family-select" title="Font ch·ªØ n√∫t">
                                <option value="Arial">Arial</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Tahoma">Tahoma</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Courier New">Courier New</option>
                            </select>
                        </div>
                        <div class="style-group">
                            <label for="node-font-size-input">C·ª°:</label>
                            <input type="number" id="node-font-size-input" min="8" max="72" title="C·ª° ch·ªØ n√∫t">
                        </div>
                        <div class="style-group">
                            <label for="node-icon-select">Icon:</label>
                            <select id="node-icon-select" title="Bi·ªÉu t∆∞·ª£ng n√∫t">
                                <option value="">Kh√¥ng c√≥</option>
                                <option value="‚≠ê">‚≠ê Ng√¥i sao</option>
                                <option value="üí°">üí° B√≥ng ƒë√®n</option>
                                <option value="‚úîÔ∏è">‚úîÔ∏è Check</option>
                                <option value="‚ùó">‚ùó Ch√∫ √Ω</option>
                                <option value="‚ùì">‚ùì H·ªèi</option>
                            </select>
                        </div>
                        <div class="style-group">
                            <label for="node-bg-color">N·ªÅn:</label>
                            <input type="color" id="node-bg-color" title="M√†u n·ªÅn n√∫t">
                        </div>
                        <div class="style-group">
                            <label for="node-text-color">Ch·ªØ:</label>
                            <input type="color" id="node-text-color" title="M√†u ch·ªØ n√∫t">
                        </div>
                        <div class="style-group">
                             <label for="node-border-color">Vi·ªÅn:</label>
                            <input type="color" id="node-border-color" title="M√†u vi·ªÅn n√∫t">
                        </div>
                        <div class="style-group">
                            <label for="node-line-color">M√†u ƒë∆∞·ªùng:</label>
                            <input type="color" id="node-line-color" title="M√†u ƒë∆∞·ªùng n·ªëi t·ª´ n√∫t n√†y">
                        </div>
                         <div class="style-group">
                            <label for="node-line-dash-select">Ki·ªÉu ƒë∆∞·ªùng:</label>
                            <select id="node-line-dash-select" title="Ki·ªÉu ƒë∆∞·ªùng n·ªëi t·ª´ n√∫t n√†y">
                                <option value="solid">Li·ªÅn</option>
                                <option value="dashed">ƒê·ª©t</option>
                                <option value="dotted">Ch·∫•m</option>
                            </select>
                        </div>
                        <div class="style-group">
                            <label for="node-line-width">D√†y:</label>
                            <input type="number" id="node-line-width" min="1" max="10" title="ƒê·ªô d√†y ƒë∆∞·ªùng n·ªëi t·ª´ n√∫t n√†y">
                        </div>
                    </div>
                </div>
                <div id="konva-container-loading" class="loading-indicator hidden">ƒêang t·∫£i s∆° ƒë·ªì...</div>
                <div id="konva-container"></div>
            </div>
        </section>

        <div id="context-menu" class="hidden">
            <ul>
                <li id="ctx-add-child">Th√™m n√∫t con (Tab)</li>
                <li id="ctx-edit-text">S·ª≠a vƒÉn b·∫£n (Enter)</li>
                <li id="ctx-view-full-content">üìÑ Xem to√†n b·ªô n·ªôi dung</li>
                <li id="ctx-suggest-children">‚ú® G·ª£i √Ω n√∫t con (AI)</li>
                <li id="ctx-expand-node">üîç M·ªü r·ªông √Ω t∆∞·ªüng (AI)</li>
                <li id="ctx-generate-examples">üí° AI T·∫°o V√≠ D·ª•</li>
                <li id="ctx-ask-ai-node">üí¨ H·ªèi AI v·ªÅ n√∫t n√†y...</li>
                <li id="ctx-summarize-branch">üìÑ AI T√≥m t·∫Øt nh√°nh n√†y</li>
                <li id="ctx-generate-action-plan">üöÄ AI T·∫°o K·∫ø ho·∫°ch H√†nh ƒë·ªông</li>
                <li id="ctx-delete-node">X√≥a n√∫t & con (Delete)</li>
            </ul>
        </div>

        <div id="ai-loading-indicator" class="hidden">ƒêang x·ª≠ l√Ω AI...</div>

        <div id="ai-response-modal-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="ai-response-modal-title">Ph·∫£n h·ªìi t·ª´ AI</h4>
                    <button id="ai-response-modal-close-button" class="modal-close-button">&times;</button>
                </div>
                <div class="modal-body" id="ai-response-modal-body"></div>
            </div>
        </div>

        <div id="node-content-modal-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="node-content-modal-title">N·ªôi dung ƒë·∫ßy ƒë·ªß c·ªßa n√∫t</h4>
                    <button id="node-content-modal-close-button" class="modal-close-button">&times;</button>
                </div>
                <div class="modal-body" id="node-content-modal-body">
                    </div>
            </div>
        </div>

        <div id="edit-node-text-modal-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="edit-node-text-modal-title">S·ª≠a n·ªôi dung n√∫t</h4>
                    <button id="edit-node-text-modal-close-button" class="modal-close-button">&times;</button>
                </div>
                <div class="modal-body">
                    <textarea id="edit-node-textarea" style="width: 100%; min-height: 150px; box-sizing: border-box; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; line-height: 1.5;" placeholder="Nh·∫≠p n·ªôi dung cho n√∫t..."></textarea>
                </div>
                <div class="modal-footer">
                    <button id="edit-node-text-modal-cancel-button" class="secondary">H·ªßy</button>
                    <button id="edit-node-text-modal-save-button">L∆∞u thay ƒë·ªïi</button>
                </div>
            </div>
        </div>

    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
